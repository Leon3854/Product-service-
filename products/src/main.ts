import { NestFactory } from '@nestjs/core';
import { AppModule } from './app.module';
import { PrismaService } from './prisma.service';
/**
 * –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (Entry Point) –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
 * –û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é NestJS –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö —Å–µ—Ç–µ–≤—ã—Ö –ø–æ–ª–∏—Ç–∏–∫
 * –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–µ–Ω–Ω—ã–º —Ü–∏–∫–ª–æ–º (Lifecycle) –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.
 *
 * –ö–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:
 * 1. –°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è API: —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ—Ñ–∏–∫—Å–∞ /api –¥–ª—è –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è.
 * 2. –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å (CORS): –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞ —Å–æ–≥–ª–∞—Å–Ω–æ White-list –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç CSRF.
 * 3. Graceful Shutdown: –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π Prisma –ø—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ –ø—Ä–æ—Ü–µ—Å—Å–∞.
 * 4. Docker-Ready Listening: –ø—Ä–∏–≤—è–∑–∫–∞ –∫ —Ö–æ—Å—Ç—É 0.0.0.0 –¥–ª—è —Ä–∞–±–æ—Ç—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
 */
async function bootstrap() {
  const app = await NestFactory.create(AppModule);

  // –ì–ª–æ–±–∞–ª—å–Ω—ã–π –ø—Ä–µ—Ñ–∏–∫—Å –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å API –æ—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–∞–π–ª–æ–≤ –∏–ª–∏ –¥—Ä—É–≥–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
  app.setGlobalPrefix('/api');

  // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cross-Origin Resource Sharing (CORS)
  // –ù–µ–æ–±—Ö–æ–¥–∏–º–∞ –¥–ª—è –ª–µ–≥–∏—Ç–∏–º–Ω–æ–≥–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è Frontend-—á–∞—Å—Ç–∏ (–Ω–∞–ø—Ä. Vite/React) —Å –±—ç–∫–µ–Ω–¥–æ–º
  app.enableCors({
    origin: process.env.CORS_ORIGEN || 'http://localhost:5173',
    methods: 'GET,HEAD,PUT,PATCH,POST,DELETE',
    credentials: true,
  });

  // –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —Ö—É–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã –¥–ª—è Prisma.
  // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –∞–∫—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –±—É–¥—É—Ç –∑–∞–≤–µ—Ä—à–µ–Ω—ã, –∞ –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π –∑–∞–∫—Ä—ã—Ç –±–µ–∑ —É—Ç–µ—á–µ–∫.
  const prismaService = app.get(PrismaService);
  // –í–∫–ª—é—á–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã
  prismaService.enableShutdownHook(app);

  // 4. –ü–†–ê–í–ò–õ–¨–ù–´–ô –ó–ê–ü–£–°–ö –ù–ê –ü–û–†–¢–£ –ò –•–û–°–¢–ï
  const PORT = process.env.PORT || 3000;

  // –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ '0.0.0.0' –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è Docker: —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
  // –ø—Ä–∏–Ω–∏–º–∞—Ç—å –≤—Ö–æ–¥—è—â–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∏–∑–≤–Ω–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
  await app.listen(PORT, '0.0.0.0');

  console.log(`üöÄ Application is running on: http://localhost:${PORT}/api`);
  console.log(`üìë GraphQL Playground: http://localhost:${PORT}/graphql`);
}
// –ó–∞–ø—É—Å–∫ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ—à–∏–±–æ–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
bootstrap()
  .then(() => console.log('Application started successfully'))
  .catch((error) => {
    console.log('Application failed to started', error);
    process.exit(1);
  });

/**
 * Graceful Shutdown: –£–ø–æ–º–∏–Ω–∞–Ω–∏–µ ¬´–∑–∞–≤–µ—Ä—à–µ–Ω–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∏ –∑–∞–∫—Ä—ã—Ç–∏—è –ø—É–ª–∞ –±–µ–∑ —É—Ç–µ—á–µ–∫¬ª
 * –ü–æ–Ω–∏–º–∞–Ω–∏–µ —Ç–æ–≥–æ —á—Ç–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´—É–º–∏—Ä–∞—Ç—å¬ª, –∞ —É—Ö–æ–¥–∏—Ç—å –∫—Ä–∞—Å–∏–≤–æ.
 * Docker-Ready: –ó–∞—á–µ–º –Ω—É–∂–µ–Ω 0.0.0.0. –≠—Ç–æ —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞ –Ω–æ–≤–∏—á–∫–æ–≤, –∏–∑-–∑–∞ –∫–æ—Ç–æ—Ä–æ–π
 * –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –Ω–µ ¬´–≤–∏–¥—è—Ç¬ª –¥—Ä—É–≥ –¥—Ä—É–≥–∞.
 * CORS –∏ CSRF: –°–≤—è–∑—ã–≤–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫—É CORS —Å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å—é, –∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ ¬´—á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–æ¬ª.
 * Error Handling: –ë–ª–æ–∫ .catch —Å process.exit(1) –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –µ—Å–ª–∏ –ø–æ—Ä—Ç –∑–∞–Ω—è—Ç –∏–ª–∏
 * –±–∞–∑–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ ¬´–∑–∞–≤–∏—Å–Ω–µ—Ç¬ª –≤ –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏, –∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ —É–ø–∞–¥–µ—Ç,
 * —á—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è Health Checks –≤ Docker/K8s.
 */
